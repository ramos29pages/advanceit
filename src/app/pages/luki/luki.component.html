<div class="flex flex-col h-screen max-w-2xl mx-auto bg-gradient-to-br from-purple-50 via-gray-50 to-white">
  <!-- Header -->
  <div class="bg-gradient-to-r from-purple-600 via-purple-700 to-gray-700 text-white p-4 shadow-lg">
    <h1 class="text-xl font-bold text-center">Advance Chat</h1>
    <div class="text-center text-sm opacity-90 mt-1">
      <span class="inline-block w-2 h-2 bg-green-400 rounded-full mr-2 animate-pulse"></span>
      Conectado
    </div>
  </div>

  <!-- Welcome Message (solo se muestra al inicio) -->
  <div *ngIf="showWelcome() && messages().length === 0" class="welcome-container p-8 text-center animate__animated animate__fadeInDown">
    <div class="welcome-text text-4xl font-bold mb-4 bg-gradient-to-r from-purple-600 via-orange-500 to-purple-800 bg-clip-text text-transparent animate__animated animate__pulse animate__infinite">
      ¡Hola! Bienvenido a Advance
    </div>
    <p class="text-gray-600 text-lg">Tu asistente inteligente está listo para ayudarte</p>
    <div class="mt-6">
      <div class="inline-flex items-center space-x-2 bg-purple-100 px-4 py-2 rounded-full">
        <div class="w-3 h-3 bg-purple-500 rounded-full animate-bounce"></div>
        <div class="w-3 h-3 bg-orange-500 rounded-full animate-bounce" style="animation-delay: 0.2s;"></div>
        <div class="w-3 h-3 bg-purple-700 rounded-full animate-bounce" style="animation-delay: 0.4s;"></div>
      </div>
    </div>
  </div>

  <!-- Messages Container -->
  <div class="flex-1 overflow-hidden px-4 pt-4">
    <div #messagesContainer class="h-full overflow-y-auto space-y-4 pb-4 scrollbar-thin scrollbar-thumb-purple-300 scrollbar-track-gray-100">

      <!-- Mensajes en orden cronológico -->
      <div *ngFor="let msg of getAllMessagesInOrder(); trackBy: trackByMessageId"
           class="animate__animated animate__fadeInUp"
           [ngClass]="msg.isUser ? 'flex justify-end' : 'flex justify-start'">

        <!-- User Message -->
        <div *ngIf="msg.isUser"
             class="max-w-xs lg:max-w-md bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-2xl rounded-tr-sm px-4 py-3 shadow-lg transform hover:scale-105 transition-all duration-200">
          <div class="font-medium mb-1">{{ msg.content }}</div>
          <div class="flex items-center justify-end space-x-2 text-xs opacity-90">
            <span>{{ getTimeString(msg.timestamp) }}</span>
            <div class="flex items-center">
              <span [ngClass]="{
                'text-yellow-200': msg.state === 'PENDING',
                'text-blue-200': msg.state === 'SENT',
                'text-green-200': msg.state === 'RECEIVED',
                'text-red-200': msg.state === 'ERROR'
              }">
                <fa-icon
                  [icon]="getMessageIcon(msg.state)"
                  [ngClass]="getIconClass(msg.state)">
                </fa-icon>
              </span>
            </div>
          </div>
        </div>

        <!-- AI Response -->
        <div *ngIf="!msg.isUser"
             class="max-w-xs lg:max-w-md bg-white border border-gray-200 rounded-2xl rounded-tl-sm px-4 py-3 shadow-lg transform hover:scale-105 transition-all duration-200">
          <div class="flex items-center mb-2">
            <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-orange-500 rounded-full flex items-center justify-center mr-3">
              <fa-icon [icon]="faRobot" class="text-white text-sm"></fa-icon>
            </div>
            <span class="font-semibold text-gray-700">Advance AI</span>
          </div>
          <div class="text-gray-800 leading-relaxed">{{ msg.content }}</div>
          <div class="text-xs text-gray-500 mt-2 text-right">
            {{ getTimeString(msg.timestamp) }}
          </div>
        </div>
      </div>

      <!-- Typing Indicator -->
      <div *ngIf="isTyping() && !showWelcome()" class="flex justify-start animate__animated animate__fadeIn">
        <div class="bg-white border border-gray-200 rounded-2xl rounded-tl-sm px-4 py-3 shadow-lg">
          <div class="flex items-center mb-2">
            <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-orange-500 rounded-full flex items-center justify-center mr-3">
              <fa-icon [icon]="faRobot" class="text-white text-sm"></fa-icon>
            </div>
            <span class="font-semibold text-gray-700">Advance AI está escribiendo...</span>
          </div>
          <div class="flex space-x-1">
            <div class="w-2 h-2 bg-purple-400 rounded-full animate-bounce"></div>
            <div class="w-2 h-2 bg-purple-400 rounded-full animate-bounce" style="animation-delay: 0.2s;"></div>
            <div class="w-2 h-2 bg-purple-400 rounded-full animate-bounce" style="animation-delay: 0.4s;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Input Area (Fixed at bottom) -->
  <div class="bg-white border-t border-gray-200 p-4 shadow-lg">
    <form (ngSubmit)="sendMessage()" class="flex items-end space-x-3">
      <div class="flex-1 relative">
        <textarea
          [ngModel]="messageText()"
          (ngModelChange)="messageText.set($event)"
          (keydown)="onKeyDown($event)"
          name="message"
          placeholder="Escribe tu mensaje aquí..."
          rows="1"
          class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none transition-all duration-200 scrollbar-thin scrollbar-thumb-purple-300"
          style="max-height: 120px; overflow-y: auto;"
        ></textarea>
        <button
          type="button"
          class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-purple-500 transition-colors"
          title="Adjuntar archivo"
        >
          <fa-icon [icon]="faPaperclip"></fa-icon>
        </button>
      </div>
      <button
        type="submit"
        [disabled]="!messageText().trim()"
        class="w-12 h-12 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-full hover:from-purple-600 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 shadow-lg"
      >
        <fa-icon [icon]="faPaperPlane"></fa-icon>
      </button>
    </form>

    <!-- Quick Actions -->
    <div class="flex justify-center mt-3 space-x-2">
      <button
        *ngFor="let action of quickActions"
        (click)="sendQuickMessage(action)"
        class="px-3 py-1 bg-gray-100 hover:bg-purple-100 text-sm text-gray-700 hover:text-purple-700 rounded-full transition-all duration-200 transform hover:scale-105"
      >
        {{ action }}
      </button>
    </div>
  </div>
</div>

<!-- Custom Styles -->
<style>
  @import url('https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css');

  .welcome-container {
    background: linear-gradient(135deg, rgba(147, 51, 234, 0.1) 0%, rgba(249, 115, 22, 0.1) 50%, rgba(147, 51, 234, 0.1) 100%);
    border-radius: 20px;
    margin: 20px;
    border: 1px solid rgba(147, 51, 234, 0.2);
  }

  .welcome-text {
    animation: gradient 3s ease infinite;
    background-size: 200% 200%;
  }

  @keyframes gradient {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  .scrollbar-thin::-webkit-scrollbar {
    width: 6px;
  }

  .scrollbar-thin::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 10px;
  }

  .scrollbar-thin::-webkit-scrollbar-thumb {
    background: #d8b4fe;
    border-radius: 10px;
  }

  .scrollbar-thin::-webkit-scrollbar-thumb:hover {
    background: #c084fc;
  }

  /* Smooth scrolling */
  .overflow-y-auto {
    scroll-behavior: smooth;
  }

  /* Message hover effects */
  .max-w-xs, .max-w-md {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Input focus animation */
  textarea:focus {
    box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.1);
  }

  /* Button press animation */
  button:active {
    transform: scale(0.95);
  }

  /* FontAwesome spin animation */
  .fa-spin {
    animation: fa-spin 2s infinite linear;
  }

  @keyframes fa-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(359deg); }
  }
</style>
